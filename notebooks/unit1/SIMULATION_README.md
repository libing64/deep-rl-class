# LunarLander-v2 仿真说明

## 📋 概述

这是一个带有图形界面的 LunarLander-v2 环境仿真脚本，可以可视化观察月球着陆器的行为。

## 🚀 快速开始

### 方法 1: 使用启动脚本（推荐）

```bash
cd /home/libing/source/ml/rl/deep-rl-class/notebooks/unit1
./run_simulation.sh
```

### 方法 2: 直接运行 Python 脚本

```bash
cd /home/libing/source/ml/rl/deep-rl-class/notebooks/unit1
conda run -n deep-rl-class python lunar_lander_simulation.py
```

## 🎮 运行模式

### 模式 1: 实时显示（Pygame 窗口）
- 在新窗口中实时显示着陆器的运动
- 可以看到着陆器的实时动画
- 运行 3 个回合
- **适合：** 直观观察着陆器的行为

### 模式 2: 数据分析图表（Matplotlib）
- 生成详细的分析图表
- 包括轨迹、速度、角度、奖励等
- 保存为 PNG 图片
- **适合：** 分析着陆器的性能数据

### 模式 3: 两种模式都运行
- 先运行实时显示
- 然后生成分析图表
- **适合：** 全面了解着陆器的行为和性能

## 📊 输出内容

### 控制台输出
- 环境信息（观察空间、动作空间）
- 每个回合的详细步骤
- 最终统计数据（平均奖励、最高奖励等）

### 图表输出（模式 2 和 3）
1. **轨迹图**：显示着陆器的飞行路径
2. **速度图**：水平和垂直速度随时间变化
3. **角度图**：着陆器的倾斜角度变化
4. **水平位置图**：X 坐标随时间变化
5. **即时奖励图**：每步获得的奖励
6. **累积奖励图**：总奖励的累积曲线

### 保存的文件
- `lunar_lander_simulation_results.png` - 分析图表

## 🎯 观察状态说明

环境的观察状态包含 8 个维度：

| 索引 | 含义 | 说明 |
|------|------|------|
| 0 | 水平坐标 (x) | 着陆器的水平位置 |
| 1 | 垂直坐标 (y) | 着陆器的高度 |
| 2 | 水平速度 (vx) | 水平方向的速度 |
| 3 | 垂直速度 (vy) | 垂直方向的速度 |
| 4 | 角度 | 着陆器的倾斜角度 |
| 5 | 角速度 | 角度变化的速度 |
| 6 | 左腿接触 | 左腿是否接触地面 |
| 7 | 右腿接触 | 右腿是否接触地面 |

## 🕹️ 动作空间

着陆器有 4 种可能的动作：

| 动作 | 说明 |
|------|------|
| 0 | 无操作 - 不启动任何引擎 |
| 1 | 左引擎点火 - 向右推动 |
| 2 | 主引擎点火 - 向上推动 |
| 3 | 右引擎点火 - 向左推动 |

## 🏆 奖励机制

- 成功着陆：+100 分
- 坠毁：-100 分
- 每步根据以下因素给予奖励：
  - 接近着陆点：正奖励
  - 速度较慢：正奖励
  - 保持水平：正奖励
  - 腿部接触地面：每条腿 +10 分
  - 使用侧引擎：每帧 -0.03 分
  - 使用主引擎：每帧 -0.3 分

## 📝 注意事项

1. **随机策略**：当前脚本使用随机策略，性能较差是正常的
2. **训练后性能**：训练后的智能体可以获得 200+ 的奖励
3. **显示问题**：如果无法显示 pygame 窗口，请使用模式 2（图表分析）
4. **性能**：实时显示会稍慢，这是为了更好地观察动画效果

## 🔧 自定义参数

您可以直接编辑 `lunar_lander_simulation.py` 来修改参数：

```python
# 修改最大步数
simulator.run_with_display(max_steps=1000, num_episodes=5, delay=0.01)

# 修改延迟（更慢或更快）
delay=0.05  # 更慢
delay=0.001  # 更快
```

## 🐛 故障排除

### 问题：无法显示 pygame 窗口
**解决方案**：使用模式 2（图表分析模式）

### 问题：ImportError
**解决方案**：确保已安装所有依赖
```bash
conda activate deep-rl-class
pip install gymnasium[box2d] matplotlib numpy
```

### 问题：中文显示乱码
**解决方案**：脚本已使用英文，不会有中文显示问题

## 📚 相关资源

- [Gymnasium 文档](https://gymnasium.farama.org/)
- [LunarLander-v2 环境](https://gymnasium.farama.org/environments/box2d/lunar_lander/)
- [Stable-Baselines3](https://stable-baselines3.readthedocs.io/)

## 🎓 下一步

1. 观察随机策略的表现
2. 了解环境的动态特性
3. 学习如何训练智能体（见 unit1.ipynb）
4. 尝试训练一个能够成功着陆的智能体！

---

享受探索过程！🚀🌙

