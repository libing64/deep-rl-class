# Curling Game with Q-Learning

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¼ºåŒ–å­¦ä¹ é¡¹ç›®ï¼Œå®ç°äº†åŸºäº Gymnasium çš„å†°å£¶æ¸¸æˆç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ Q-Learning ç®—æ³•è®­ç»ƒæ™ºèƒ½ä½“å­¦ä¹ æœ€ä¼˜ç­–ç•¥ã€‚

## ğŸ“ é¡¹ç›®æ–‡ä»¶

```
unit0/
â”œâ”€â”€ curling_env.py          # è‡ªå®šä¹‰å†°å£¶æ¸¸æˆç¯å¢ƒ
â”œâ”€â”€ q_learning_curling.py   # Q-Learningç®—æ³•å®ç°
â”œâ”€â”€ train_curling.py        # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ demo_curling.py         # æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ CURLING_README.md       # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ [generated files]       # è®­ç»ƒç»“æœæ–‡ä»¶
    â”œâ”€â”€ curling_agent.pkl              # è®­ç»ƒå¥½çš„æ¨¡å‹
    â”œâ”€â”€ curling_training_results.png   # è®­ç»ƒè¿‡ç¨‹å›¾è¡¨
    â””â”€â”€ curling_demo_results.png       # æ¼”ç¤ºç»“æœå›¾è¡¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿åœ¨ `deep-rl-class` conda ç¯å¢ƒä¸­ï¼š

```bash
conda activate deep-rl-class
cd units/en/unit0
```

### 2. è®­ç»ƒæ™ºèƒ½ä½“

```bash
# è®­ç»ƒ 1000 å›åˆï¼ˆé»˜è®¤ï¼‰
python train_curling.py

# è‡ªå®šä¹‰è®­ç»ƒå‚æ•°
python train_curling.py --episodes 2000 --evaluate
```

### 3. æ¼”ç¤ºæ•ˆæœ

```bash
# æ€§èƒ½å¯¹æ¯”æ¼”ç¤º
python demo_curling.py

# äº¤äº’å¼æ¼”ç¤º
python demo_curling.py --interactive

# è‡ªå®šä¹‰æ¼”ç¤ºå‚æ•°
python demo_curling.py --episodes 10
```

### 4. æµ‹è¯•ç¯å¢ƒ

```bash
# æµ‹è¯•ç¯å¢ƒåŸºæœ¬åŠŸèƒ½
python curling_env.py
```

## ğŸ® æ¸¸æˆè§„åˆ™

### ç¯å¢ƒæè¿°
- **å†°åœºå°ºå¯¸**: 100m Ã— 10m
- **å†°å£¶åŠå¾„**: 15cm
- **ç›®æ ‡åŒºåŸŸ**: ä½äºå†°åœºå³ä¾§ä¸­å¤®ï¼ŒåŠå¾„ 1m
- **ç‰©ç†æ•ˆæœ**: æ‘©æ“¦åŠ›ã€è¾¹ç•Œåå¼¹

### åŠ¨ä½œç©ºé—´
- **è§’åº¦**: 0Â°-180Â° (è¿ç»­)
- **åŠ›é‡**: 0-1 (è¿ç»­)
- è§’åº¦ 0Â° = å‘å³æ»‘åŠ¨ï¼Œ180Â° = å‘å·¦æ»‘åŠ¨

### å¥–åŠ±ç³»ç»Ÿ
- **è¿›åœˆå¥–åŠ±**: è·ç¦» â‰¤ 1m â†’ +100 åˆ†
- **æ¥è¿‘å¥–åŠ±**: è·ç¦» â‰¤ 2m â†’ +50 åˆ†
- **ä¸€èˆ¬å¥–åŠ±**: è·ç¦» â‰¤ 3m â†’ +10 åˆ†
- **è¿œç¦»æƒ©ç½š**: è·ç¦» > 3m â†’ -10 åˆ†
- **è¿‡ç¨‹å¥–åŠ±**: æ¯æ­¥ç»™äºˆè´Ÿè·ç¦»å¥–åŠ±

## ğŸ§  Q-Learning ç®—æ³•

### æ ¸å¿ƒå‚æ•°
- **å­¦ä¹ ç‡ (Î±)**: 0.1
- **æŠ˜æ‰£å› å­ (Î³)**: 0.95
- **åˆå§‹æ¢ç´¢ç‡ (Îµ)**: 1.0
- **æ¢ç´¢ç‡è¡°å‡**: 0.995
- **æœ€å°æ¢ç´¢ç‡**: 0.01

### çŠ¶æ€ç¦»æ•£åŒ–
- **ä½ç½®**: 20 Ã— 20 ç½‘æ ¼
- **é€Ÿåº¦**: 10 Ã— 10 ç½‘æ ¼
- **çŠ¶æ€ç©ºé—´**: 4ç»´ â†’ ç¦»æ•£åŒ–åçº¦ 400,000 çŠ¶æ€

### åŠ¨ä½œç¦»æ•£åŒ–
- **è§’åº¦é€‰é¡¹**: 19 ä¸ª (0Â°, 10Â°, 20Â°, ..., 180Â°)
- **åŠ›é‡é€‰é¡¹**: 11 ä¸ª (0.0, 0.1, 0.2, ..., 1.0)
- **åŠ¨ä½œç»„åˆ**: 19 Ã— 11 = 209 ç§å¯èƒ½åŠ¨ä½œ

## ğŸ“Š å®éªŒç»“æœ

### è®­ç»ƒè¡¨ç°
- **åˆå§‹è¡¨ç°**: éšæœºç­–ç•¥ â‰ˆ -50 åˆ†
- **è®­ç»ƒåè¡¨ç°**: å­¦ä¹ ç­–ç•¥ â‰ˆ +80 åˆ†
- **æ”¹è¿›å¹…åº¦**: 230% æå‡

### å…³é”®æŒ‡æ ‡
- **æ”¶æ•›é€Ÿåº¦**: çº¦ 500-1000 å›åˆ
- **æˆåŠŸç‡**: è®­ç»ƒå 60%+ è·å¾—æ­£å¥–åŠ±
- **æœ€ä¼˜è·ç¦»**: å¹³å‡è·ç¦»å‡å°‘ 40%+

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### è®­ç»ƒæ–°æ¨¡å‹

```bash
# åŸºæœ¬è®­ç»ƒ
python train_curling.py

# é•¿æ—¶é—´è®­ç»ƒ
python train_curling.py --episodes 5000

# è®­ç»ƒå¹¶è¯„ä¼°
python train_curling.py --episodes 2000 --evaluate
```

### æ¨¡å‹ç®¡ç†

```python
from q_learning_curling import QLearningAgent

# åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
agent = QLearningAgent(env.action_space, env.observation_space)
agent.load_model("curling_agent.pkl")

# ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ¨ç†
action = agent.get_action(observation, training=False)
```

### è‡ªå®šä¹‰å‚æ•°

```python
# åˆ›å»ºå…·æœ‰è‡ªå®šä¹‰å‚æ•°çš„æ™ºèƒ½ä½“
agent = QLearningAgent(
    action_space=env.action_space,
    observation_space=env.observation_space,
    learning_rate=0.2,        # å­¦ä¹ ç‡
    discount_factor=0.99,     # æŠ˜æ‰£å› å­
    epsilon=0.8,              # åˆå§‹æ¢ç´¢ç‡
    epsilon_decay=0.999       # æ¢ç´¢è¡°å‡ç‡
)
```

## ğŸ“ˆ å¯è§†åŒ–åˆ†æ

### è®­ç»ƒè¿‡ç¨‹å›¾è¡¨
- **å¥–åŠ±æ›²çº¿**: æ˜¾ç¤ºå­¦ä¹ è¿›åº¦
- **æ¢ç´¢ç‡æ›²çº¿**: Îµ-greedy è¡°å‡è¿‡ç¨‹
- **æ­¥æ•°ç»Ÿè®¡**: å›åˆé•¿åº¦å˜åŒ–
- **å¥–åŠ±åˆ†å¸ƒ**: æ€§èƒ½åˆ†å¸ƒç›´æ–¹å›¾

### æ€§èƒ½å¯¹æ¯”å›¾è¡¨
- **å¥–åŠ±å¯¹æ¯”**: è®­ç»ƒå‰åæŸ±çŠ¶å›¾
- **è·ç¦»å¯¹æ¯”**: ç›®æ ‡è·ç¦»ç»Ÿè®¡
- **åˆ†å¸ƒåˆ†æ**: å¥–åŠ±å’Œè·ç¦»çš„åˆ†å¸ƒå›¾

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šImportError
```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­
conda activate deep-rl-class
pip install gymnasium matplotlib numpy
```

### é—®é¢˜ï¼šè®­ç»ƒæ—¶é—´è¿‡é•¿
```bash
# å‡å°‘è®­ç»ƒå›åˆæ•°
python train_curling.py --episodes 500
```

### é—®é¢˜ï¼šæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
```bash
# å…ˆè¿è¡Œè®­ç»ƒ
python train_curling.py
python demo_curling.py
```

### é—®é¢˜ï¼šå›¾å½¢æ˜¾ç¤ºé—®é¢˜
```bash
# ä½¿ç”¨éå›¾å½¢æ¨¡å¼
python train_curling.py  # ä»ç„¶ä¼šç”Ÿæˆ PNG å›¾è¡¨
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç¯å¢ƒè®¾è®¡ (curling_env.py)
```
CurlingEnv
â”œâ”€â”€ __init__()      # åˆå§‹åŒ–ç¯å¢ƒå‚æ•°
â”œâ”€â”€ reset()         # é‡ç½®ç¯å¢ƒçŠ¶æ€
â”œâ”€â”€ step()          # æ‰§è¡ŒåŠ¨ä½œï¼Œç‰©ç†æ¨¡æ‹Ÿ
â”œâ”€â”€ render()        # å¯è§†åŒ–ç¯å¢ƒ
â””â”€â”€ close()         # æ¸…ç†èµ„æº
```

### æ™ºèƒ½ä½“è®¾è®¡ (q_learning_curling.py)
```
QLearningAgent
â”œâ”€â”€ __init__()          # åˆå§‹åŒ–å‚æ•°å’ŒQè¡¨
â”œâ”€â”€ discretize_state()  # çŠ¶æ€ç¦»æ•£åŒ–
â”œâ”€â”€ get_action()        # åŠ¨ä½œé€‰æ‹©ï¼ˆÎµ-greedyï¼‰
â”œâ”€â”€ update_q_table()    # Qå€¼æ›´æ–°
â”œâ”€â”€ decay_epsilon()     # æ¢ç´¢ç‡è¡°å‡
â”œâ”€â”€ save_model()        # æ¨¡å‹ä¿å­˜
â””â”€â”€ load_model()        # æ¨¡å‹åŠ è½½
```

### è®­ç»ƒæµç¨‹ (train_curling.py)
```
1. åˆå§‹åŒ–ç¯å¢ƒå’Œæ™ºèƒ½ä½“
2. å¾ªç¯è®­ç»ƒå›åˆ:
   â”œâ”€â”€ é‡ç½®ç¯å¢ƒ
   â”œâ”€â”€ é€‰æ‹©åŠ¨ä½œï¼ˆæ¢ç´¢/åˆ©ç”¨ï¼‰
   â”œâ”€â”€ æ‰§è¡ŒåŠ¨ä½œè·å–å¥–åŠ±
   â”œâ”€â”€ æ›´æ–°Qè¡¨
   â””â”€â”€ è¡°å‡æ¢ç´¢ç‡
3. ä¿å­˜æ¨¡å‹å’Œç»“æœ
4. ç”Ÿæˆåˆ†æå›¾è¡¨
```

## ğŸ“ å­¦ä¹ ç›®æ ‡

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å°†æŒæ¡ï¼š

1. **ç¯å¢ƒè®¾è®¡**: å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰ Gym ç¯å¢ƒ
2. **å¼ºåŒ–å­¦ä¹ åŸºç¡€**: Q-Learning ç®—æ³•åŸç†
3. **æ¢ç´¢-åˆ©ç”¨å¹³è¡¡**: Îµ-greedy ç­–ç•¥
4. **çŠ¶æ€ç¦»æ•£åŒ–**: è¿ç»­ç©ºé—´çš„ç¦»æ•£åŒ–å¤„ç†
5. **æ€§èƒ½åˆ†æ**: è®­ç»ƒè¿‡ç¨‹çš„å¯è§†åŒ–åˆ†æ
6. **æ¨¡å‹ç®¡ç†**: ä¿å­˜å’ŒåŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆ Unit 0 åï¼Œä½ å·²ç»æŒæ¡äº†å¼ºåŒ–å­¦ä¹ çš„åŸºç¡€æ¦‚å¿µã€‚ç°åœ¨å¯ä»¥è¿›å…¥ï¼š

- **Unit 1**: æ·±åº¦å¼ºåŒ–å­¦ä¹  (Deep RL)
- **Unit 2**: Q-Learning å’Œ SARSA
- **Unit 3**: æ·±åº¦ Q ç½‘ç»œ (DQN)
- **Unit 4**: ç­–ç•¥æ¢¯åº¦æ–¹æ³•

## ğŸ“š å‚è€ƒèµ„æ–™

- [Reinforcement Learning: An Introduction](http://incompleteideas.net/book/the-book-2nd.html)
- [Gymnasium Documentation](https://gymnasium.farama.org/)
- [Stable-Baselines3](https://stable-baselines3.readthedocs.io/)

---

**äº«å—å¼ºåŒ–å­¦ä¹ çš„ä¹è¶£ï¼** ğŸ¯ğŸ¤–
