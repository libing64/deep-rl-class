# Frozen Lake with Q-Learning

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¼ºåŒ–å­¦ä¹ é¡¹ç›®ï¼Œä½¿ç”¨ Q-Learning ç®—æ³•è§£å†³ç»å…¸çš„ Frozen Lake ç¯å¢ƒã€‚æ™ºèƒ½ä½“éœ€è¦ä»èµ·ç‚¹å®‰å…¨åˆ°è¾¾ç›®æ ‡ï¼ŒåŒæ—¶é¿å¼€å†°æ¹–ä¸Šçš„æ´ã€‚

## ğŸ“ é¡¹ç›®æ–‡ä»¶

```
unit0/
â”œâ”€â”€ frozen_lake_env.py          # Frozen Lakeç¯å¢ƒåŒ…è£…å™¨
â”œâ”€â”€ q_learning_frozen_lake.py   # Q-Learningç®—æ³•å®ç°
â”œâ”€â”€ train_frozen_lake.py        # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ demo_frozen_lake.py         # æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ FROZEN_LAKE_README.md       # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ [generated files]           # è®­ç»ƒç»“æœæ–‡ä»¶
    â”œâ”€â”€ frozen_lake_4x4_slippery_agent.pkl              # è®­ç»ƒå¥½çš„æ¨¡å‹
    â”œâ”€â”€ frozen_lake_4x4_slippery_training_results.png   # è®­ç»ƒè¿‡ç¨‹å›¾è¡¨
    â”œâ”€â”€ frozen_lake_4x4_slippery_policy_values.png      # ç­–ç•¥å’Œå€¼å‡½æ•°å›¾è¡¨
    â”œâ”€â”€ frozen_lake_4x4_slippery_demo_results.png       # æ¼”ç¤ºç»“æœå›¾è¡¨
    â””â”€â”€ frozen_lake_4x4_slippery_eval_results.pkl       # è¯„ä¼°ç»“æœ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿åœ¨ `deep-rl-class` conda ç¯å¢ƒä¸­ï¼š

```bash
conda activate deep-rl-class
cd units/en/unit0
```

### 2. è®­ç»ƒæ™ºèƒ½ä½“

```bash
# è®­ç»ƒ 4x4 åœ°å›¾ï¼ˆé»˜è®¤ï¼Œå…‰æ»‘å†°é¢ï¼‰
python train_frozen_lake.py

# è®­ç»ƒ 8x8 åœ°å›¾
python train_frozen_lake.py --map 8x8

# è®­ç»ƒéå…‰æ»‘å†°é¢
python train_frozen_lake.py --no-slippery

# è‡ªå®šä¹‰è®­ç»ƒå‚æ•°
python train_frozen_lake.py --episodes 10000 --evaluate 200
```

### 3. æ¼”ç¤ºæ•ˆæœ

```bash
# æ€§èƒ½å¯¹æ¯”æ¼”ç¤º
python demo_frozen_lake.py

# è‡ªå®šä¹‰æ¼”ç¤ºå‚æ•°
python demo_frozen_lake.py --map 8x8 --episodes 50

# äº¤äº’å¼æ¼”ç¤º
python demo_frozen_lake.py --interactive

# æ˜¾ç¤ºå­¦ä¹ åˆ°çš„ç­–ç•¥
python demo_frozen_lake.py --policy
```

### 4. æµ‹è¯•ç¯å¢ƒ

```bash
# æµ‹è¯•ç¯å¢ƒåŸºæœ¬åŠŸèƒ½
python frozen_lake_env.py
```

## ğŸ® æ¸¸æˆè§„åˆ™

### ç¯å¢ƒæè¿°
- **4x4 åœ°å›¾**: 16ä¸ªæ ¼å­ï¼ŒåŒ…æ‹¬èµ·ç‚¹(S)ã€ç›®æ ‡(G)ã€å†°å—(F)å’Œæ´(H)
- **8x8 åœ°å›¾**: 64ä¸ªæ ¼å­ï¼Œæ›´å¤æ‚çš„æŒ‘æˆ˜
- **å…‰æ»‘å†°é¢**: åŠ¨ä½œå¯èƒ½å¯¼è‡´æ»‘è¡Œåˆ°éé¢„æœŸä½ç½®
- **éå…‰æ»‘å†°é¢**: åŠ¨ä½œç›´æ¥åˆ°è¾¾é¢„æœŸä½ç½®

### é»˜è®¤ 4x4 åœ°å›¾å¸ƒå±€

```
S F F F
F H F H
F F F H
H F F G
```

### åŠ¨ä½œç©ºé—´
- **0**: å·¦ç§» (LEFT)
- **1**: ä¸‹ç§» (DOWN)
- **2**: å³ç§» (RIGHT)
- **3**: ä¸Šç§» (UP)

### å¥–åŠ±ç³»ç»Ÿ
- **åˆ°è¾¾ç›®æ ‡**: +1.0 å¥–åŠ±
- **æ‰å…¥æ´ä¸­**: 0.0 å¥–åŠ±ï¼ˆç»ˆæ­¢ï¼‰
- **æ¯æ­¥ç§»åŠ¨**: 0.0 å¥–åŠ±ï¼ˆç›´åˆ°åˆ°è¾¾ç›®æ ‡æˆ–æ‰å…¥æ´ä¸­ï¼‰

## ğŸ§  Q-Learning ç®—æ³•

### æ ¸å¿ƒå‚æ•°
- **å­¦ä¹ ç‡ (Î±)**: 0.1
- **æŠ˜æ‰£å› å­ (Î³)**: 0.99
- **åˆå§‹æ¢ç´¢ç‡ (Îµ)**: 1.0
- **æ¢ç´¢ç‡è¡°å‡**: 0.9995
- **æœ€å°æ¢ç´¢ç‡**: 0.01

### çŠ¶æ€ç©ºé—´
- **4x4 åœ°å›¾**: 16ä¸ªçŠ¶æ€ (0-15)
- **8x8 åœ°å›¾**: 64ä¸ªçŠ¶æ€ (0-63)
- æ¯ä¸ªçŠ¶æ€ä»£è¡¨æ™ºèƒ½ä½“åœ¨åœ°å›¾ä¸Šçš„ä½ç½®

### åŠ¨ä½œç©ºé—´
- **4ä¸ªåŠ¨ä½œ**: å·¦ã€ä¸‹ã€å³ã€ä¸Š
- åœ¨å…‰æ»‘å†°é¢ä¸Šï¼ŒåŠ¨ä½œå¯èƒ½å¯¼è‡´éšæœºç§»åŠ¨

## ğŸ“Š å®éªŒç»“æœ

### 4x4 å…‰æ»‘å†°é¢ (å…¸å‹ç»“æœ)
- **æœ€ç»ˆæˆåŠŸç‡**: ~70-80%
- **æ”¶æ•›é€Ÿåº¦**: çº¦ 2000-3000 å›åˆ
- **æœ€ä¼˜ç­–ç•¥**: æ‰¾åˆ°é¿å¼€æ´çš„æœ€çŸ­è·¯å¾„

### 4x4 éå…‰æ»‘å†°é¢
- **æœ€ç»ˆæˆåŠŸç‡**: ~90-95%
- **æ”¶æ•›é€Ÿåº¦**: çº¦ 1000-2000 å›åˆ
- **æœ€ä¼˜ç­–ç•¥**: ç¡®å®šæ€§çš„æœ€çŸ­è·¯å¾„

### 8x8 åœ°å›¾
- **æœ€ç»ˆæˆåŠŸç‡**: ~50-70% (å…‰æ»‘), ~80-90% (éå…‰æ»‘)
- **æ”¶æ•›é€Ÿåº¦**: çº¦ 5000-10000 å›åˆ
- **æŒ‘æˆ˜**: æ›´å¤§çš„çŠ¶æ€ç©ºé—´å’Œæ›´å¤šéšœç¢

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### è®­ç»ƒæ–°æ¨¡å‹

```bash
# åŸºæœ¬è®­ç»ƒï¼ˆ4x4ï¼Œå…‰æ»‘ï¼‰
python train_frozen_lake.py

# é«˜çº§è®­ç»ƒé€‰é¡¹
python train_frozen_lake.py \
    --map 8x8 \
    --no-slippery \
    --episodes 10000 \
    --evaluate 500
```

### æ¨¡å‹ç®¡ç†

```python
from q_learning_frozen_lake import QLearningAgent

# åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
agent = QLearningAgent(n_states=16, n_actions=4)
agent.load_model("frozen_lake_4x4_slippery_agent.pkl")

# ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ¨ç†
action = agent.get_action(state, training=False)
```

### è‡ªå®šä¹‰å‚æ•°

```python
# åˆ›å»ºå…·æœ‰è‡ªå®šä¹‰å‚æ•°çš„æ™ºèƒ½ä½“
agent = QLearningAgent(
    n_states=16,          # çŠ¶æ€æ•°é‡
    n_actions=4,          # åŠ¨ä½œæ•°é‡
    learning_rate=0.2,    # å­¦ä¹ ç‡
    discount_factor=0.95, # æŠ˜æ‰£å› å­
    epsilon=0.8,          # åˆå§‹æ¢ç´¢ç‡
    epsilon_decay=0.995   # æ¢ç´¢è¡°å‡ç‡
)
```

## ğŸ® æ¼”ç¤ºæ¨¡å¼

### æ€§èƒ½å¯¹æ¯”
```bash
python demo_frozen_lake.py --episodes 50
```
- æ¯”è¾ƒè®­ç»ƒæ™ºèƒ½ä½“ vs éšæœºæ™ºèƒ½ä½“
- æ˜¾ç¤ºæˆåŠŸç‡ã€æ­¥æ•°ã€è·¯å¾„å·®å¼‚

### äº¤äº’å¼æ¼”ç¤º
```bash
python demo_frozen_lake.py --interactive
```
- å®æ—¶è§‚çœ‹æ™ºèƒ½ä½“å¯¼èˆªè¿‡ç¨‹
- æ˜¾ç¤ºæ¯æ­¥çš„å†³ç­–å’Œç»“æœ

### ç­–ç•¥å¯è§†åŒ–
```bash
python demo_frozen_lake.py --policy
```
- æ˜¾ç¤ºå­¦ä¹ åˆ°çš„æœ€ä¼˜ç­–ç•¥
- æ˜¾ç¤ºçŠ¶æ€å€¼å‡½æ•°
- ASCIIè‰ºæœ¯åœ°å›¾å±•ç¤º

## ğŸ“ˆ å¯è§†åŒ–åˆ†æ

### è®­ç»ƒè¿‡ç¨‹å›¾è¡¨
- **å¥–åŠ±æ›²çº¿**: æ˜¾ç¤ºå­¦ä¹ è¿›åº¦
- **æˆåŠŸç‡æ›²çº¿**: ç§»åŠ¨å¹³å‡æˆåŠŸç‡
- **æ¢ç´¢ç‡æ›²çº¿**: Îµ è¡°å‡è¿‡ç¨‹
- **æ­¥æ•°ç»Ÿè®¡**: å›åˆé•¿åº¦å˜åŒ–

### ç­–ç•¥åˆ†æå›¾è¡¨
- **ç­–ç•¥çƒ­åŠ›å›¾**: æ¯ä¸ªçŠ¶æ€çš„æœ€ä¼˜åŠ¨ä½œ
- **å€¼å‡½æ•°çƒ­åŠ›å›¾**: æ¯ä¸ªçŠ¶æ€çš„å€¼ä¼°è®¡
- **åœ°å›¾å åŠ **: ç­–ç•¥å åŠ åœ¨åŸå§‹åœ°å›¾ä¸Š

### æ€§èƒ½å¯¹æ¯”å›¾è¡¨
- **æˆåŠŸç‡å¯¹æ¯”**: è®­ç»ƒ vs éšæœºæ™ºèƒ½ä½“
- **æ­¥æ•°åˆ†å¸ƒ**: å®Œæˆä»»åŠ¡çš„æ­¥æ•°ç»Ÿè®¡
- **å­¦ä¹ æ›²çº¿**: ç´¯ç§¯å¹³å‡å¥–åŠ±
- **è·¯å¾„é•¿åº¦**: è§£å†³æ–¹æ¡ˆçš„é•¿åº¦åˆ†å¸ƒ

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šImportError
```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­
conda activate deep-rl-class
pip install gymnasium matplotlib numpy
```

### é—®é¢˜ï¼šè®­ç»ƒæ—¶é—´è¿‡é•¿
```bash
# ä½¿ç”¨æ›´å°‘çš„è®­ç»ƒå›åˆ
python train_frozen_lake.py --episodes 1000

# æˆ–è€…ä½¿ç”¨éå…‰æ»‘ç¯å¢ƒï¼ˆæ›´å®¹æ˜“å­¦ä¹ ï¼‰
python train_frozen_lake.py --no-slippery
```

### é—®é¢˜ï¼šæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
```bash
# å…ˆè¿è¡Œè®­ç»ƒ
python train_frozen_lake.py
python demo_frozen_lake.py
```

### é—®é¢˜ï¼š8x8åœ°å›¾è®­ç»ƒå›°éš¾
```bash
# ä½¿ç”¨éå…‰æ»‘ç¯å¢ƒ
python train_frozen_lake.py --map 8x8 --no-slippery --episodes 20000
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç¯å¢ƒåŒ…è£…å™¨ (frozen_lake_env.py)
```
FrozenLakeWrapper
â”œâ”€â”€ __init__()          # åˆå§‹åŒ–ç¯å¢ƒå‚æ•°
â”œâ”€â”€ reset()            # é‡ç½®ç¯å¢ƒçŠ¶æ€
â”œâ”€â”€ step()             # æ‰§è¡ŒåŠ¨ä½œ
â”œâ”€â”€ render()           # ASCIIæ¸²æŸ“
â”œâ”€â”€ render_ascii()     # è‡ªå®šä¹‰ASCIIæ˜¾ç¤º
â”œâ”€â”€ get_map_info()     # è·å–åœ°å›¾ä¿¡æ¯
â””â”€â”€ close()            # æ¸…ç†èµ„æº
```

### æ™ºèƒ½ä½“å®ç° (q_learning_frozen_lake.py)
```
QLearningAgent
â”œâ”€â”€ __init__()              # åˆå§‹åŒ–å‚æ•°å’ŒQè¡¨
â”œâ”€â”€ get_action()            # åŠ¨ä½œé€‰æ‹©ï¼ˆÎµ-greedyï¼‰
â”œâ”€â”€ update_q_table()        # Qå€¼æ›´æ–°
â”œâ”€â”€ decay_epsilon()         # æ¢ç´¢ç‡è¡°å‡
â”œâ”€â”€ get_optimal_policy()    # è·å–æœ€ä¼˜ç­–ç•¥
â”œâ”€â”€ get_state_values()      # è·å–çŠ¶æ€å€¼
â”œâ”€â”€ save_model()            # æ¨¡å‹ä¿å­˜
â”œâ”€â”€ load_model()            # æ¨¡å‹åŠ è½½
â””â”€â”€ get_stats()             # è·å–ç»Ÿè®¡ä¿¡æ¯
```

### è®­ç»ƒæµç¨‹ (train_frozen_lake.py)
```
1. åˆå§‹åŒ–ç¯å¢ƒå’Œæ™ºèƒ½ä½“
2. å¾ªç¯è®­ç»ƒå›åˆ:
   â”œâ”€â”€ é‡ç½®ç¯å¢ƒ
   â”œâ”€â”€ é€‰æ‹©åŠ¨ä½œï¼ˆæ¢ç´¢/åˆ©ç”¨ï¼‰
   â”œâ”€â”€ æ‰§è¡ŒåŠ¨ä½œè·å–å¥–åŠ±
   â”œâ”€â”€ æ›´æ–°Qè¡¨
   â””â”€â”€ è¡°å‡æ¢ç´¢ç‡
3. ä¿å­˜æ¨¡å‹å’Œç»“æœ
4. ç”Ÿæˆåˆ†æå›¾è¡¨
```

## ğŸ“ å­¦ä¹ ç›®æ ‡

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å°†æŒæ¡ï¼š

1. **ç»å…¸ç¯å¢ƒ**: ç†è§£ Frozen Lake ç¯å¢ƒçš„åŠ¨æ€ç‰¹æ€§
2. **Q-Learning**: å®ç°è¡¨æ ¼å‹ Q-Learning ç®—æ³•
3. **æ¢ç´¢-åˆ©ç”¨å¹³è¡¡**: Îµ-greedy ç­–ç•¥çš„åº”ç”¨
4. **çŠ¶æ€å€¼ä¼°è®¡**: å€¼å‡½æ•°å’Œç­–ç•¥çš„å­¦ä¹ 
5. **æ€§èƒ½åˆ†æ**: è®­ç»ƒè¿‡ç¨‹çš„å¯è§†åŒ–åˆ†æ
6. **æ¨¡å‹è¯„ä¼°**: è®­ç»ƒå‰åæ€§èƒ½å¯¹æ¯”

## ğŸš€ ä¸‹ä¸€æ­¥

å®Œæˆ Unit 0 åï¼Œä½ å·²ç»æŒæ¡äº†å¼ºåŒ–å­¦ä¹ çš„åŸºç¡€æ¦‚å¿µã€‚ç°åœ¨å¯ä»¥è¿›å…¥ï¼š

- **Unit 1**: æ·±åº¦å¼ºåŒ–å­¦ä¹  (Deep RL)
- **Unit 2**: Q-Learning å’Œ SARSA
- **Unit 3**: æ·±åº¦ Q ç½‘ç»œ (DQN)
- **Unit 4**: ç­–ç•¥æ¢¯åº¦æ–¹æ³•

## ğŸ“š å‚è€ƒèµ„æ–™

- [Frozen Lake Environment](https://gymnasium.farama.org/environments/toy_text/frozen_lake/)
- [Reinforcement Learning: An Introduction](http://incompleteideas.net/book/the-book-2nd.html)
- [Q-Learning Algorithm](https://en.wikipedia.org/wiki/Q-learning)
- [Gymnasium Documentation](https://gymnasium.farama.org/)

---

**äº«å—å¼ºåŒ–å­¦ä¹ çš„ä¹è¶£ï¼** ğŸ§ŠğŸ¤–
